<main>
<div *ngIf="loading" class="loader-container">
  <app-loader></app-loader>
</div>

<header class="hero">
  <div class="hero-content">
    <h2>Vehículos de la clase {{ classId === 1 ? 'B' : classId === 2 ? 'A' : 'S+' }}</h2>
    <p>Vehículo de Carretera:</p>
    <ul>
      <li><strong>Victoria:</strong> Vehículo estándar. Sigue bien a todos los vehículos de esta sección. Cambia entre modo B y A según las exigencias del vehículo que perseguimos.</li>
      <li><strong>Explorer:</strong> Vehículo ancho; se puede complicar en callejones porque no entra en muchas rutas estrechas.</li>
      <li><strong>Dorado:</strong> Coche que solo se usará para vehículos que no se puedan seguir con los demás.</li>
    </ul>
    <p>Vehículo Offroad:</p>
    <ul>
      <li><strong>Terminus Overland:</strong> Perfecta para subir escaleras y muros pequeños. Va bien por el monte, pero le cuesta girar en curvas cerradas.</li>
      <li><strong>Seminole Frontier:</strong> Mala en carretera, buena para montaña; sube cualquier montaña y le dan igual los arbustos.</li>
      <li><strong>Bison:</strong> Clase C. Grande y robusta, sirve para bloquear callejones e ir por montaña. Algunos saltos no los hace bien; es como una pequeña ballenita, salta en vertical y se queda corta.</li>
      <li><strong>Invictus:</strong></li>
    </ul>
  </div>
</header>

<div class="vehicles-list">
  <div *ngFor="let v of vehicles" class="vehicle-card">
    <div class="img-container">
      <span class="class-badge">
        {{ v.class_id === 1 ? 'B' : v.class_id === 2 ? 'A' : 'S+' }}
      </span>
      <span class="class-copy">
        <span (click)="copyModel(v.model)" class="material-symbols-outlined">
          copy_all
        </span>
      </span>
      <img [src]="v.image_url" alt="{{ v.name }}" />
    </div>
    <div class="vehicle-info">
      <h3>{{ v.name }}</h3>
      <p>Se sige con: {{ v.follow_class }}</p>
      <div class="buttons">
        <button class="edit-btn" (click)="startEdit(v)">Editar</button>
        <button class="delete-btn" (click)="deleteVehicle(v.id)">Eliminar</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="editingVehicle" class="edit-form">
  <h3>Editar vehículo</h3>

  <input type="text" [(ngModel)]="editingVehicle.name" placeholder="Nombre" />
  <input type="text" [(ngModel)]="editingVehicle.model" placeholder="Modelo" />
  <input type="text" [(ngModel)]="editingVehicle.image_url" placeholder="URL imagen" />

  <div class="preview" *ngIf="editingVehicle.image_url">
    <img
      [src]="editingVehicle.image_url"
      (load)="onImageLoad()"
      (error)="onImageError()"
    />
    <p *ngIf="editingVehicle.image_url.startsWith('data:')" class="error-msg">
      ❌ No se permiten imágenes en formato data URL
    </p>
    <p *ngIf="!imageOk" class="error-msg">
      ❌ La imagen no carga o el enlace no es válido
    </p>
  </div>

  <select name="class_id" id="class_id" [(ngModel)]="editingVehicle.class_id">
    <option value="1">Clase B</option>
    <option value="2">Clase A</option>
    <option value="3">Clase S+</option>
  </select>

  <span>Se sigue con:</span>
  <input type="text" name="follow_class" id="follow_class" [(ngModel)]="editingVehicle.follow_class" placeholder="Clase a seguir" />

  <div class="form-buttons">
    <button class="save-btn" (click)="editVehicle()" [disabled]="!imageOk || editingVehicle.image_url.startsWith('data:')">Guardar</button>
    <button class="cancel-btn" (click)="editingVehicle = null">Cancelar</button>
  </div>
</div>

<button class="add-btn" (click)="startAdd()">Añadir vehículo</button>

<div *ngIf="addingVehicle" class="edit-form">
  <h3>Añadir vehículo</h3>

  <input type="text" [(ngModel)]="addingVehicle.name" placeholder="Nombre" />
  <input type="text" [(ngModel)]="addingVehicle.model" placeholder="Modelo" />
  <input type="text" [(ngModel)]="addingVehicle.image_url" placeholder="URL imagen" />

  <div class="preview" *ngIf="addingVehicle.image_url">
    <img
      [src]="addingVehicle.image_url"
      (load)="onImageLoad()"
      (error)="onImageError()"
    />
    <p *ngIf="addingVehicle.image_url.startsWith('data:')" class="error-msg">
      ❌ No se permiten imágenes en formato data URL
    </p>
    <p *ngIf="!imageOk" class="error-msg">
      ❌ La imagen no carga o el enlace no es válido
    </p>
  </div>

  <select name="class_id" id="class_id" [(ngModel)]="addingVehicle.class_id">
    <option value="1">Clase B</option>
    <option value="2">Clase A</option>
    <option value="3">Clase S+</option>
  </select>

  <span>Se sigue con:</span>
  <input type="text" name="follow_class" id="follow_class" [(ngModel)]="addingVehicle.follow_class" placeholder="Clase a seguir" />

  <div class="form-buttons">
    <button class="save-btn" (click)="addVehicle()" [disabled]="!imageOk || addingVehicle.image_url.startsWith('data:')">Guardar</button>
    <button class="cancel-btn" (click)="addingVehicle = null">Cancelar</button>
  </div>
</div>

</main>
<main>
<div *ngIf="loading" class="loader-container">
  <app-loader></app-loader>
</div>

<header class="hero" [ngSwitch]="classId">
  <div class="hero-content">
    <h2>Veh√≠culos de la clase {{ classLabel }}</h2>

    <!-- CLASE B -->
    <div *ngSwitchCase="1" class="texto">
      <p>Veh√≠culo de Carretera:</p>
      <ul>
        <li><strong>Victoria:</strong> Veh√≠culo est√°ndar. Sigue bien a todos los veh√≠culos de esta secci√≥n. Cambiando de modo B y A seg√∫n las exigencias del veh√≠culo que perseguimos.</li>
        <li><strong>Explorer:</strong> Veh√≠culo ancho; Se puede complicar en callejones porque no entra en muchas rutas tiktok.</li>
        <li><strong>Dorado:</strong> Coche que solo se usar√° para veh√≠culos que no se puedan seguir con los dem√°s.</li>
      </ul>

      <p>Veh√≠culo Offroad:</p>
      <ul>
        <li><strong>Terminus Overland:</strong> Perfecta para subir escaleras y muros peque√±os. Va bien por el monte. Le cuesta girar en curvas cerradas.  </li>
        <li><strong>Seminole Frontier:</strong> Mala en carretera, buena para monta√±a; sube cualquier monta√±a y le dan igual los arbustos. </li>
        <li><strong>Bison:</strong> Clase C. Grande y robusta, sirve para bloquear callejones e ir por monta√±a. Algunos saltos no los hace bien; es como una peque√±a ballenita, salta en vertical y se queda corta. </li>
        <li><strong>Invictus:</strong></li>
      </ul>
    </div>

    <!-- CLASE A -->
    <div *ngSwitchCase="2" class="texto">
      <p>Veh√≠culo de Carretera:</p>
      <ul>
        <li><strong>Taurus</strong></li>
        <li><strong>Bufalo</strong></li>
        <li><strong>Landstalker</strong></li>
      </ul>

      <p>Veh√≠culo Offroad:</p>
      <ul>
        <li><strong>Terminus:</strong> Buena para monte.</li>
      </ul>
    </div>

    <!-- CLASE S+ -->
    <div *ngSwitchCase="3" class="texto">
      <p>Pr√≥ximamente üöîüî•</p>
    </div>

  </div>
</header>

<div class="vehicles-list">
  <div *ngFor="let v of vehicles" class="vehicle-card">
    <div class="img-container">
      <span class="class-badge">
        {{ v.class_id === 1 ? 'B' : v.class_id === 2 ? 'A' : 'S+' }}
      </span>
      <span class="class-copy">
        <span (click)="copyModel(v.model)" class="material-symbols-outlined">
          copy_all
        </span>
      </span>
      <img [src]="v.image_url" (click)="openImage(v.image_url)" class="clickable-img" alt="{{ v.name }}" />
    </div>
    <div class="vehicle-info">
      <h3>{{ v.name }}</h3>
      <p>Se sige con: {{ v.follow_class }}</p>
      <p>Nota: {{ v.note }}</p>
      <div class="buttons">
        <button class="edit-btn" (click)="startEdit(v)">Editar</button>
        <button class="delete-btn" (click)="deleteVehicle(v.id)">Eliminar</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="editingVehicle" class="edit-form">
  <h3>Editar veh√≠culo</h3>

  <input type="text" [(ngModel)]="editingVehicle.name" placeholder="Nombre" />
  <input type="text" [(ngModel)]="editingVehicle.model" placeholder="Modelo" />
  <input type="text" [(ngModel)]="editingVehicle.image_url" placeholder="URL imagen" />

  <div class="preview" *ngIf="editingVehicle.image_url">
    <img
      [src]="editingVehicle.image_url"
      (load)="onImageLoad()"
      (error)="onImageError()"
    />
    <p *ngIf="editingVehicle.image_url.startsWith('data:')" class="error-msg">
      ‚ùå No se permiten im√°genes en formato data URL
    </p>
    <p *ngIf="!imageOk" class="error-msg">
      ‚ùå La imagen no carga o el enlace no es v√°lido
    </p>
  </div>

  <select name="class_id" id="class_id" [(ngModel)]="editingVehicle.class_id">
    <option value="1">Clase B</option>
    <option value="2">Clase A</option>
    <option value="3">Clase S+</option>
  </select>

  <span>Se sigue con:</span>
  <input type="text" name="follow_class" id="follow_class" [(ngModel)]="editingVehicle.follow_class" placeholder="Clase a seguir" />
  <input type="text" name="note" id="note" [(ngModel)]="editingVehicle.note" placeholder="Nota" />
  <div class="form-buttons">
    <button class="save-btn" (click)="editVehicle()" [disabled]="!imageOk || editingVehicle.image_url.startsWith('data:')">Guardar</button>
    <button class="cancel-btn" (click)="editingVehicle = null">Cancelar</button>
  </div>
</div>

<button class="add-btn" (click)="startAdd()">A√±adir veh√≠culo</button>

<div *ngIf="addingVehicle" class="edit-form">
  <h3>A√±adir veh√≠culo</h3>

  <input type="text" [(ngModel)]="addingVehicle.name" placeholder="Nombre" />
  <input type="text" [(ngModel)]="addingVehicle.model" placeholder="Modelo" />
  <input type="text" [(ngModel)]="addingVehicle.image_url" placeholder="URL imagen" />

  <div class="preview" *ngIf="addingVehicle.image_url">
    <img
      [src]="addingVehicle.image_url"
      (load)="onImageLoad()"
      (error)="onImageError()"
    />
    <p *ngIf="addingVehicle.image_url.startsWith('data:')" class="error-msg">
      ‚ùå No se permiten im√°genes en formato data URL
    </p>
    <p *ngIf="!imageOk" class="error-msg">
      ‚ùå La imagen no carga o el enlace no es v√°lido
    </p>
  </div>

  <select name="class_id" id="class_id" [(ngModel)]="addingVehicle.class_id">
    <option value="1">Clase B</option>
    <option value="2">Clase A</option>
    <option value="3">Clase S+</option>
  </select>

  <span>Se sigue con:</span>
  <input type="text" name="follow_class" id="follow_class" [(ngModel)]="addingVehicle.follow_class" placeholder="Clase a seguir" />
  <input type="text" name="note" id="note" [(ngModel)]="addingVehicle.note" placeholder="Nota" />
  <div class="form-buttons">
    <button class="save-btn" (click)="addVehicle()" [disabled]="!imageOk || addingVehicle.image_url.startsWith('data:')">Guardar</button>
    <button class="cancel-btn" (click)="addingVehicle = null">Cancelar</button>
  </div>
</div>

<div class="image-modal" *ngIf="selectedImage" (click)="closeImage()">
  <img [src]="selectedImage" (click)="$event.stopPropagation()" />
  <span class="close-btn" (click)="closeImage()">‚úï</span>
</div>

</main>